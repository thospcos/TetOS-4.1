<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Machine Love</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background: white;
        font-family: Arial, sans-serif;
        overflow: hidden;
    }

    #textBox {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: black;
        font-size: 60px;
        text-align: center;
        white-space: pre-wrap;
    }

    .line {
        margin: 10px 0;
    }

    .word {
        display: inline-block;
        opacity: 0;
        transition: opacity 0s; /* NO fade */
        margin: 0 10px;
    }

    #whiteScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: white;
        display: none; /* pops instantly */
    }
</style>
</head>
<body>

<audio id="bgm" src="machine_love.mp3.mp3" autoplay loop></audio>

<div id="whiteScreen"></div>
<div id="textBox"></div>

<script>
const textBox = document.getElementById("textBox");
const bgm = document.getElementById("bgm");
const whiteScreen = document.getElementById("whiteScreen");

document.addEventListener("DOMContentLoaded", () => {
    bgm.volume = 0.7;
    bgm.play().catch(() => {
        document.body.addEventListener("click", () => bgm.play());
    });
});

function showTextTemporary(t, duration = 2500) {
    return new Promise(resolve => {
        textBox.innerText = t;
        textBox.style.opacity = 1;

        setTimeout(() => {
            textBox.style.opacity = 0;
            setTimeout(resolve, 1000);
        }, duration);
    });
}

// WORD-BY-WORD APPEAR, NO FADE
function spawnWordsLine(words, delayBetween = 700) {
    return new Promise(resolve => {
        const line = document.createElement("div");
        line.className = "line";
        textBox.appendChild(line);

        let index = 0;

        function reveal() {
            const w = document.createElement("span");
            w.className = "word";
            w.textContent = words[index];
            line.appendChild(w);

            // pop instantly
            setTimeout(() => { w.style.opacity = 1; }, 20);

            index++;
            if (index < words.length) {
                setTimeout(reveal, delayBetween);
            } else {
                resolve();
            }
        }

        reveal();
    });
}

async function sequence() {
    await showTextTemporary("This song is a tribute to\n耳のあるロボットの唄\n(Song of the Eared Robot)\nby nwp8861.");

    await showTextTemporary("It is about the truths that lay\nin hiding within artifice,\nand a computer falling in love.");

    // WHITE SCREEN POP
    whiteScreen.style.display = "block";
    textBox.style.opacity = 1;
    textBox.innerHTML = ""; // clear previous text

    // FINAL SEQUENCE — WORD BY WORD  
    await spawnWordsLine(["Machine", "Love"], 700);
    await spawnWordsLine(["by", "Jamie", "Paige"], 700);
    await spawnWordsLine(["featuring", "Kasane", "Teto", "SV"], 700);
}

sequence();
</script>

</body>
</html>
